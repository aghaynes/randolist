<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assessing imbalance • randotools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing imbalance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">randotools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/randotools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/imbalance.html">Assessing imbalance</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CTU-Bern/randolist" target="_blank"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assessing imbalance</h1>
            
      

      <div class="d-none name"><code>imbalance.Rmd</code></div>
    </div>

    
    
<p>When running a trial, it may be useful to periodically check how well
balanced the randomisation is. This is especially true where procedures
relying on random elements such as minimization are used instead of
pre-defined randomisation lists.</p>
<p><code>randotools</code> provides a couple of tools to assist in
assessing how well balanced the randomisation has been performed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctu-bern.github.io/randolist/" class="external-link">randotools</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h3>
<p>As an example, we will use a dataset that is included within the
package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rando_balance</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rando_balance</span><span class="op">)</span></span>
<span><span class="co">#&gt;      strat1        strat2     rando_res          rando_res2       </span></span>
<span><span class="co">#&gt;  Min.   :0.0   Min.   :0.0   Length:100         Length:100        </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0   1st Qu.:0.0   Class :character   Class :character  </span></span>
<span><span class="co">#&gt;  Median :0.5   Median :0.5   Mode  :character   Mode  :character  </span></span>
<span><span class="co">#&gt;  Mean   :0.5   Mean   :0.5                                        </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0   3rd Qu.:1.0                                        </span></span>
<span><span class="co">#&gt;  Max.   :1.0   Max.   :1.0</span></span></code></pre></div>
<p>The dataset contains four variables:- two stratification variables,
and two randomisation variables. One randomisation variable,
<code>rando_res</code> has balanced randomisation. The other,
<code>rando_res2</code>, has a small degree of imbalance.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">rando_balance</span><span class="op">$</span><span class="va">rando_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; trt1 trt2 </span></span>
<span><span class="co">#&gt;   50   50</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">rando_balance</span><span class="op">$</span><span class="va">rando_res2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; trt1 trt2 </span></span>
<span><span class="co">#&gt;   53   47</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sequential-plots">Sequential plots<a class="anchor" aria-label="anchor" href="#sequential-plots"></a>
</h3>
<p>The <code>imbalance_seq_plots</code> function aids in plotting the
imbalance as a function of randomisation number (assuming that the data
is sorted from oldest to newest).</p>
<p>This function produces up to 6 plots, so the <code>patchwork</code>
package comes in useful for combining the plots via
<code>wrap_plots</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/imbalance_seq_plots.html">imbalance_seq_plots</a></span><span class="op">(</span><span class="va">rando_balance</span>, </span>
<span>                    randovar <span class="op">=</span> <span class="st">"rando_res"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="imbalance_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>On the left we see the balance in the observed data. On the right, we
see a simulated dataset with completely random assignment. We would
generally want the observed curve to be below that of the randomly
generated data.</p>
<p>Where stratification variables are included, additional plots are
shown with lines for each level of the the stratification variable(s)
(the second row) and the specific strata (the combination of each
stratification variable; the last row).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/imbalance_seq_plots.html">imbalance_seq_plots</a></span><span class="op">(</span><span class="va">rando_balance</span>, </span>
<span>                    randovar <span class="op">=</span> <span class="st">"rando_res"</span>,</span>
<span>                    stratavars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strat1"</span>, <span class="st">"strat2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="imbalance_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="testing-imbalance">Testing imbalance<a class="anchor" aria-label="anchor" href="#testing-imbalance"></a>
</h3>
<p>We also provide a permutation-type test, and accompanying plot, for
comparing the observed randomisation imbalance with multiple simulated
datasets. The null hypothesis for the test is that imbalance is lower or
equal in the random data than relative to observed data. As such, we
want a small p-value.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imbalance_test.html">imbalance_test</a></span><span class="op">(</span><span class="va">rando_balance</span>, </span>
<span>                      randovar <span class="op">=</span> <span class="st">"rando_res2"</span>,</span>
<span>                      stratavars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strat1"</span>, <span class="st">"strat2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imb</span></span>
<span><span class="co">#&gt; Randomisations to date: 100 </span></span>
<span><span class="co">#&gt; Overall imbalance: 6 </span></span>
<span><span class="co">#&gt;   Probability of equal or less imbalance from random allocation: 0.498 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Randomisation stratified by strat1 and strat2 </span></span>
<span><span class="co">#&gt; Maximum observed imbalanced within stratifying variables: 4 </span></span>
<span><span class="co">#&gt;   Probability of equal or less imbalance from random allocation: 0.355 </span></span>
<span><span class="co">#&gt; Maximum observed imbalanced within individual strata: 5 </span></span>
<span><span class="co">#&gt;   Probability of equal or less imbalance from random allocation: 0.364</span></span></code></pre></div>
<p>The corresponding plots show the frequency of imbalance values in the
random datasets (the bars). The red vertical line indicates that from
the observed data. Ideally, the observed line would be to the left of
the plot. The p-value is indicated bottom right.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/imbalance_test_plot.html">imbalance_test_plot</a></span><span class="op">(</span><span class="va">imb</span><span class="op">)</span></span></code></pre></div>
<p><img src="imbalance_files/figure-html/unnamed-chunk-8-1.png" width="384"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alan G Haynes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
